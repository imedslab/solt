

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>solt.transforms._transforms &mdash; solt v0.2.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../../_static/custom.css?v=0b1ce4df" />

  
      <script src="../../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../../_static/documentation_options.js?v=683873e3"></script>
      <script src="../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../index.html" class="icon icon-home">
            solt
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Welcome to soltâ€™s documentation!</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Modules:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules.html">solt</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../Basics_of_solt.html">Basics of <code class="docutils literal notranslate"><span class="pre">SOLT</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Helen_faces.html">Using <code class="docutils literal notranslate"><span class="pre">SOLT</span></code> to augment the keypoints (landmarks)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../DSBowl18_segmentation.html">Using <code class="docutils literal notranslate"><span class="pre">SOLT</span></code> for instance and semantic segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../Medical_Data_Augmentation_CXR14.html">Augmenting Medical Images: Chest X-ray 14 dataset</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">solt</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">solt.transforms._transforms</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for solt.transforms._transforms</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">random</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">cv2</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.signal</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">..core</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BaseTransform</span><span class="p">,</span>
    <span class="n">ImageTransform</span><span class="p">,</span>
    <span class="n">InterpolationPropertyHolder</span><span class="p">,</span>
    <span class="n">MatrixTransform</span><span class="p">,</span>
    <span class="n">PaddingPropertyHolder</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..constants</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">ALLOWED_BLURS</span><span class="p">,</span>
    <span class="n">ALLOWED_COLOR_CONVERSIONS</span><span class="p">,</span>
    <span class="n">ALLOWED_CROPS</span><span class="p">,</span>
    <span class="n">ALLOWED_INTERPOLATIONS</span><span class="p">,</span>
    <span class="n">ALLOWED_PADDINGS</span><span class="p">,</span>
    <span class="n">DTYPES_MAX</span><span class="p">,</span>
    <span class="n">ALLOWED_GRIDMASK_MODES</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..core</span><span class="w"> </span><span class="kn">import</span> <span class="n">Stream</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..core</span><span class="w"> </span><span class="kn">import</span> <span class="n">DataContainer</span><span class="p">,</span> <span class="n">Keypoints</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">..utils</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">img_shape_checker</span><span class="p">,</span>
    <span class="n">validate_numeric_range_parameter</span><span class="p">,</span>
    <span class="n">validate_parameter</span><span class="p">,</span>
<span class="p">)</span>


<div class="viewcode-block" id="Flip">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Flip">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Flip</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random Flipping transform.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of flip</span>
<span class="sd">    axis : int</span>
<span class="sd">        Axis of flip. Here, 1 stands for horizontal flipping, 0 stands for the vertical one. -1 stands for</span>
<span class="sd">        both axes.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;flip&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Flip</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">axis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Incorrect Value of axis!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="n">axis</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">img</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">img</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">img</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">...</span><span class="p">])</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">mask_new</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">mask_new</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="c1"># We should guarantee that we do not change the original data.</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">axis</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">Keypoints</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="n">pts_data</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">pts</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">pts</span><span class="o">.</span><span class="n">width</span><span class="p">)</span></div>



<div class="viewcode-block" id="Rotate">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Rotate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Rotate</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random rotation around the center clockwise</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    angle_range : tuple or float or None</span>
<span class="sd">        Range of rotation.</span>
<span class="sd">        If float, then (-angle_range, angle_range) will be used for transformation sampling.</span>
<span class="sd">        if None, then angle_range=(0,0).</span>
<span class="sd">    interpolation : str or tuple or None</span>
<span class="sd">        Interpolation type. Check the allowed interpolation types.</span>
<span class="sd">    padding : str or tuple or None</span>
<span class="sd">        Padding mode. Check the allowed padding modes.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>
<span class="sd">    ignore_state : bool</span>
<span class="sd">        Whether to ignore the state. See details in the docs for `MatrixTransform`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;rotate&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">angle_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">ignore_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Rotate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">ignore_state</span><span class="o">=</span><span class="n">ignore_state</span><span class="p">,</span>
            <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="n">ignore_fast_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">angle_range</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">angle_range</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">angle_range</span><span class="p">,</span> <span class="n">angle_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">angle_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">angle_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_angle</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">deg2rad</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">angle_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">angle_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Rotate.sample_transform_matrix">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Rotate.sample_transform_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Samples random rotation within specified range and saves it as an object state.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sample_angle</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;rot&quot;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>
</div>



<div class="viewcode-block" id="Rotate90">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Rotate90">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Rotate90</span><span class="p">(</span><span class="n">Rotate</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random rotation around the center by 90 degrees.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    k : int</span>
<span class="sd">        How many times to rotate the data. If positive, indicates the clockwise direction.</span>
<span class="sd">        Zero by default.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;rotate_90&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument `k` must be an integer!&quot;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Rotate90</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">angle_range</span><span class="o">=</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="mi">90</span><span class="p">,</span> <span class="n">k</span> <span class="o">*</span> <span class="mi">90</span><span class="p">),</span> <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="n">ignore_fast_mode</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">ascontiguousarray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">))</span></div>



<div class="viewcode-block" id="Shear">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Shear">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Shear</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random shear around the center.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range_x : tuple or float or None</span>
<span class="sd">        Shearing range along X-axis.</span>
<span class="sd">        If float, then (-range_x, range_x) will be used.</span>
<span class="sd">        If None, then range_x=(0, 0)</span>
<span class="sd">    range_y : tuple or float or None</span>
<span class="sd">        Shearing range along Y-axis. If float, then (-range_y, range_y) will be used.</span>
<span class="sd">        If None, then range_y=(0, 0)</span>
<span class="sd">    interpolation : str or tuple or None or tuple or None</span>
<span class="sd">        Interpolation type. Check the allowed interpolation types.</span>
<span class="sd">    padding : str</span>
<span class="sd">        Padding mode. Check the allowed padding modes.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>
<span class="sd">    ignore_state : bool</span>
<span class="sd">        Whether to ignore the state. See details in the docs for `MatrixTransform`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;shear&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">ignore_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Shear</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">ignore_state</span><span class="o">=</span><span class="n">ignore_state</span><span class="p">,</span>
            <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="n">ignore_fast_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">range_x</span><span class="p">,</span> <span class="n">range_x</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">range_y</span><span class="p">,</span> <span class="n">range_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_shear</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;shear_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;shear_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;shear_x&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;shear_y&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Shear.sample_transform_matrix">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Shear.sample_transform_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">shear_x</span><span class="p">,</span> <span class="n">shear_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_shear</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">shear_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">shear_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>
</div>



<div class="viewcode-block" id="Scale">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Scale">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Scale</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random scale transform.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range_x : tuple or float or None</span>
<span class="sd">        Scaling range along X-axis.</span>
<span class="sd">        If float, then (min(1, range_x), max(1, range_x)) will be used.</span>
<span class="sd">        If None, then range_x =(1,1) by default.</span>
<span class="sd">    range_y : tuple or float</span>
<span class="sd">        Scaling range along Y-axis.</span>
<span class="sd">        If float, then (min(1, range_y), max(1, range_y)) will be used.</span>
<span class="sd">        If None, then range_y=(1,1) by default.</span>
<span class="sd">    same: bool</span>
<span class="sd">        Indicates whether to use the same scaling factor for width and height.</span>
<span class="sd">    interpolation : str or tuple or None</span>
<span class="sd">        Interpolation type. Check the allowed interpolation types.</span>
<span class="sd">        one indicates default behavior - the ``bilinear`` mode.</span>
<span class="sd">    padding : str</span>
<span class="sd">        ``z`` (zero pad) or ``r`` - reflective pad.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform</span>
<span class="sd">    ignore_state : bool</span>
<span class="sd">        Whether to ignore the state. See details in the docs for `MatrixTransform`.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;scale&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">same</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">ignore_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Scale</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">ignore_state</span><span class="o">=</span><span class="n">ignore_state</span><span class="p">,</span>
            <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="n">ignore_fast_mode</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_x</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">range_y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">same</span> <span class="o">=</span> <span class="n">same</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">range_x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="kc">None</span> <span class="k">if</span> <span class="n">range_y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_x</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">scale_y</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_y</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">same</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">scale_x</span> <span class="o">=</span> <span class="n">scale_y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">scale_y</span> <span class="o">=</span> <span class="n">scale_x</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;scale_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;scale_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale_y</span>

        <span class="k">return</span> <span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span>

<div class="viewcode-block" id="Scale.sample_transform_matrix">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Scale.sample_transform_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">scale_x</span><span class="p">,</span> <span class="n">scale_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_scale</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">scale_y</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>
</div>



<div class="viewcode-block" id="Translate">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Translate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Translate</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random Translate transform..</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    range_x: tuple or int or None</span>
<span class="sd">        Translation range along the horizontal axis. If int, then range_x=(-range_x, range_x).</span>
<span class="sd">        If None, then range_x=(0,0).</span>
<span class="sd">    range_y: tuple or int or None</span>
<span class="sd">        Translation range along the vertical axis. If int, then range_y=(-range_y, range_y).</span>
<span class="sd">        If None, then range_y=(0,0).</span>
<span class="sd">    interpolation: str</span>
<span class="sd">        Interpolation type. See allowed_interpolations in constants.</span>
<span class="sd">    padding: str</span>
<span class="sd">        Padding mode. See allowed_paddings  in constants</span>
<span class="sd">    p: float</span>
<span class="sd">        probability of applying this transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;translate&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">range_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">range_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">ignore_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Translate</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">ignore_state</span><span class="o">=</span><span class="n">ignore_state</span><span class="p">,</span>
            <span class="n">affine</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="n">ignore_fast_mode</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_x</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="o">-</span><span class="n">range_x</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="o">-</span><span class="n">range_x</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">range_y</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="o">-</span><span class="n">range_y</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="o">-</span><span class="n">range_y</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">range_y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_translate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;translate_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_x</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;translate_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range_y</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">range_y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;translate_x&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;translate_y&quot;</span><span class="p">]</span>

<div class="viewcode-block" id="Translate.sample_transform_matrix">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Translate.sample_transform_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">tx</span><span class="p">,</span> <span class="n">ty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sample_translate</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tx</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">ty</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">][</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span></div>
</div>



<div class="viewcode-block" id="Projection">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Projection">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Projection</span><span class="p">(</span><span class="n">MatrixTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Random Projective transform.</span>

<span class="sd">    Takes a set of affine transforms.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    affine_transforms : Stream or None</span>
<span class="sd">        Stream object, which has a parameterized Affine Transform.</span>
<span class="sd">        If None, then a zero degrees rotation matrix is instantiated.</span>
<span class="sd">    v_range : tuple or None</span>
<span class="sd">        Projective parameters range. If None, then ``v_range = (0, 0)``</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of using this transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;projection&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">affine_transforms</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">v_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span>
        <span class="n">padding</span><span class="o">=</span><span class="s2">&quot;z&quot;</span><span class="p">,</span>
        <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
        <span class="n">ignore_state</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">Projection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">,</span>
            <span class="n">padding</span><span class="o">=</span><span class="n">padding</span><span class="p">,</span>
            <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span>
            <span class="n">ignore_state</span><span class="o">=</span><span class="n">ignore_state</span><span class="p">,</span>
            <span class="n">affine</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">ignore_fast_mode</span><span class="o">=</span><span class="n">ignore_fast_mode</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">affine_transforms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">affine_transforms</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">affine_transforms</span><span class="p">,</span> <span class="n">Stream</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Affine transforms must be a Stream&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">trf</span> <span class="ow">in</span> <span class="n">affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">trf</span><span class="p">,</span> <span class="n">MatrixTransform</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Affine transforms must be a MatrixTransform&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">affine_transforms</span> <span class="o">=</span> <span class="n">affine_transforms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vrange</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">v_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>  <span class="c1"># projection components.</span>

<div class="viewcode-block" id="Projection.sample_transform_matrix">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Projection.sample_transform_matrix">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">trf</span> <span class="o">=</span> <span class="n">Stream</span><span class="o">.</span><span class="n">optimize_transforms_stack</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trf</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">trf</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trf</span> <span class="o">=</span> <span class="n">trf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">trf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">affine_transforms</span><span class="o">.</span><span class="n">transforms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">trf</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">trf</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">transform_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">transform_matrix</span> <span class="o">=</span> <span class="n">trf</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">transform_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">transform_matrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vrange</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">vrange</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;transform_matrix&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">transform_matrix</span></div>
</div>



<div class="viewcode-block" id="Pad">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Pad">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Pad</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">,</span> <span class="n">PaddingPropertyHolder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transformation, which pads the input to a given size</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pad_to : tuple or int or None</span>
<span class="sd">        Target size ``(width_new, height_new)``.</span>
<span class="sd">        The padding is computed using the following equations:</span>

<span class="sd">        ``left_pad = (pad_to[0] - w) // 2``</span>
<span class="sd">        ``right_pad = (pad_to[0] - w) // 2 + (pad_to[0] - w) % 2``</span>
<span class="sd">        ``top_pad = (pad_to[1] - h) // 2``</span>
<span class="sd">        ``bottom_pad = (pad_to[1] - h) // 2 + (pad_to[1] - h) % 2``</span>

<span class="sd">    padding : str</span>
<span class="sd">        Padding type.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    solt.constants.allowed_paddings</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;pad&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">BaseTransform</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">PaddingPropertyHolder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">pad_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The argument pad_to has to be tuple, list or None!&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">pad_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">pad_to</span><span class="p">,</span> <span class="n">pad_to</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span> <span class="o">=</span> <span class="n">pad_to</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Pad</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

            <span class="n">pad_w</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
            <span class="n">pad_h</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="n">pad_h_top</span> <span class="o">=</span> <span class="n">pad_h</span>
            <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="n">pad_h</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>

            <span class="n">pad_w_left</span> <span class="o">=</span> <span class="n">pad_w</span>
            <span class="n">pad_w_right</span> <span class="o">=</span> <span class="n">pad_w</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span>

            <span class="k">if</span> <span class="n">pad_h</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pad_h_top</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">if</span> <span class="n">pad_w</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">pad_w_left</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">pad_w_right</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s2">&quot;pad_h&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span><span class="p">),</span>
                <span class="s2">&quot;pad_w&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span><span class="p">),</span>
            <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>
        <span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pad_h&quot;</span><span class="p">]</span>
        <span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pad_w&quot;</span><span class="p">]</span>
        <span class="n">padding</span> <span class="o">=</span> <span class="n">ALLOWED_PADDINGS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;padding&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;strict&quot;</span><span class="p">:</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="n">ALLOWED_PADDINGS</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;padding&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">copyMakeBorder</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span><span class="p">,</span> <span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span><span class="p">,</span> <span class="n">padding</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">pad_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pts</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;z&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Padding must be &#39;z&#39;&quot;</span><span class="p">)</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">pad_h_top</span><span class="p">,</span> <span class="n">pad_h_bottom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pad_h&quot;</span><span class="p">]</span>
        <span class="n">pad_w_left</span><span class="p">,</span> <span class="n">pad_w_right</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pad_w&quot;</span><span class="p">]</span>

        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad_w_left</span>
        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">pad_h_top</span>

        <span class="k">return</span> <span class="n">Keypoints</span><span class="p">(</span>
            <span class="n">pts_data</span><span class="p">,</span>
            <span class="n">pad_h_top</span> <span class="o">+</span> <span class="n">pts</span><span class="o">.</span><span class="n">height</span> <span class="o">+</span> <span class="n">pad_h_bottom</span><span class="p">,</span>
            <span class="n">pad_w_left</span> <span class="o">+</span> <span class="n">pts</span><span class="o">.</span><span class="n">width</span> <span class="o">+</span> <span class="n">pad_w_right</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="Resize">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Resize">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Resize</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">,</span> <span class="n">InterpolationPropertyHolder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transformation, which resizes the input to a given size</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resize_to : list or tuple or int or None</span>
<span class="sd">        Target size ``(width_new, height_new)``.</span>
<span class="sd">    interpolation : str</span>
<span class="sd">        Interpolation type.</span>
<span class="sd">    keep_ar : bool</span>
<span class="sd">        Whether or not to keep the aspect ratio for non-squared images.</span>
<span class="sd">    height_first : bool</span>
<span class="sd">        In non-squared images, this will resize the height and will compute the width using the</span>
<span class="sd">        original aspect ration if ``keep_ar`` is ``True``.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    solt.constants.allowed_interpolations</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;resize&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resize_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">,</span> <span class="n">keep_ar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">height_first</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="n">BaseTransform</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">InterpolationPropertyHolder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resize_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="p">(</span><span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span> <span class="ow">and</span> <span class="p">(</span><span class="n">resize_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The argument resize_to has an incorrect type!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span> <span class="o">=</span> <span class="n">resize_to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keep_ar</span> <span class="o">=</span> <span class="n">keep_ar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height_first</span> <span class="o">=</span> <span class="n">height_first</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_handle_resize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
        <span class="n">resize_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span>
        <span class="c1"># Handling the non-square case</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">h</span> <span class="o">!=</span> <span class="n">w</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">keep_ar</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height_first</span><span class="p">:</span>
                    <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
                    <span class="n">resize_to</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">scale_factor</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
                    <span class="n">resize_to</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">scale_factor</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">resize_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">resize_to</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="n">ALLOWED_INTERPOLATIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;strict&quot;</span><span class="p">:</span>
            <span class="n">interp</span> <span class="o">=</span> <span class="n">ALLOWED_INTERPOLATIONS</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

        <span class="n">resize_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_resize</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interp</span><span class="p">)</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_apply_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">settings</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pts</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="n">resize_to</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_handle_resize</span><span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">pts</span><span class="o">.</span><span class="n">width</span><span class="p">)</span>
        <span class="n">resize_x</span><span class="p">,</span> <span class="n">resize_y</span> <span class="o">=</span> <span class="n">resize_to</span>

        <span class="n">scale_x</span> <span class="o">=</span> <span class="n">resize_x</span> <span class="o">/</span> <span class="n">pts</span><span class="o">.</span><span class="n">width</span>
        <span class="n">scale_y</span> <span class="o">=</span> <span class="n">resize_y</span> <span class="o">/</span> <span class="n">pts</span><span class="o">.</span><span class="n">height</span>

        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_x</span>
        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="n">scale_y</span>

        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts_data</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Keypoints</span><span class="p">(</span><span class="n">pts_data</span><span class="p">,</span> <span class="n">resize_y</span><span class="p">,</span> <span class="n">resize_x</span><span class="p">)</span></div>



<div class="viewcode-block" id="Crop">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Crop">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Crop</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Center / Random crop transform.</span>

<span class="sd">    Object performs center or random cropping depending on the parameters.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    crop_to : tuple or int or None</span>
<span class="sd">        Size of the crop ``(width_new, height_new)``. If ``int``, then a square crop will be made.</span>
<span class="sd">    crop_mode : str</span>
<span class="sd">        Crop mode. Can be either ``&#39;c&#39;`` - center or ``&#39;r&#39;`` - random.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    solt.constants.ALLOWED_CROPS</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;crop&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">crop_to</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crop_mode</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Crop</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">crop_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_to</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument crop_to has an incorrect type!&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">crop_mode</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_CROPS</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Argument crop_mode has an incorrect type!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_to</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">crop_to</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">crop_to</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_to</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Incorrect type of the crop_to!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">crop_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">crop_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">crop_to</span><span class="p">,</span> <span class="n">crop_to</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span> <span class="o">=</span> <span class="n">crop_to</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crop_mode</span> <span class="o">=</span> <span class="n">crop_mode</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">Crop</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">w</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Crop size must be less than the image size&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_mode</span> <span class="o">==</span> <span class="s2">&quot;r&quot;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__crop_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_mask</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img_mask</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="p">]</span>
        <span class="k">return</span> <span class="n">img_mask</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__crop_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__crop_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">pts</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span>

        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">x</span>
        <span class="n">pts_data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">y</span>

        <span class="k">return</span> <span class="n">Keypoints</span><span class="p">(</span><span class="n">pts_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">crop_to</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>



<div class="viewcode-block" id="Noise">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Noise">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Noise</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds noise to an image. Other types of data than the image are ignored.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    gain_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Final image is created as ``(1-gain)*img + gain*noise``.</span>
<span class="sd">        If float, then ``gain_range = (0, gain_range)``. If None, then ``gain_range=(0, 0)``.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;noise&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gain_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Noise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">gain_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gain_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Noise</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">h</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">w</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">c</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">obj</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;I&quot;</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">w</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
                <span class="k">break</span>

        <span class="k">if</span> <span class="n">w</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">h</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">c</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Image must have 3 channels&quot;</span><span class="p">)</span>

        <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">noise_img</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

        <span class="n">noise_img</span> <span class="o">-=</span> <span class="n">noise_img</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
        <span class="n">noise_img</span> <span class="o">/=</span> <span class="n">noise_img</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="n">noise_img</span> <span class="o">*=</span> <span class="mi">255</span>
        <span class="n">noise_img</span> <span class="o">=</span> <span class="n">noise_img</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;noise&quot;</span><span class="p">:</span> <span class="n">noise_img</span><span class="p">,</span> <span class="s2">&quot;gain&quot;</span><span class="p">:</span> <span class="n">gain</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">addWeighted</span><span class="p">(</span>
            <span class="n">img</span><span class="p">,</span>
            <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;noise&quot;</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;gain&quot;</span><span class="p">],</span>
            <span class="mi">0</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pts</span></div>



<div class="viewcode-block" id="CutOut">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.CutOut">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CutOut</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Does cutout augmentation.</span>

<span class="sd">    https://arxiv.org/abs/1708.04552</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cutout_size : tuple or int or float or None</span>
<span class="sd">        The size of the cutout. If None, then it is equal to 2.</span>
<span class="sd">    n_cuts: int or tuple of int</span>
<span class="sd">        Number of cutouts to make. By default, it is 1.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;cutout&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cutout_size</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">n_cuts</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CutOut</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cutout size is of an incorrect type!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n_cuts</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Incorrect n_cuts type&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">n_cuts</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot make less than 0 cutouts&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">cutout_size</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Cutout size must be a tuple of int or float&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">cutout_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">cutout_size</span><span class="p">,</span> <span class="n">cutout_size</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">1</span><span class="p">])):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;CutOut sizes must be of the same type&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span> <span class="o">=</span> <span class="n">cutout_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_cuts</span> <span class="o">=</span> <span class="n">n_cuts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">CutOut</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">cut_size_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cut_size_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">cut_size_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cut_size_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cutout_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">cut_size_x</span> <span class="o">&gt;</span> <span class="n">w</span> <span class="ow">or</span> <span class="n">cut_size_y</span> <span class="o">&gt;</span> <span class="n">h</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cutout size is too large!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cut_size_x&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut_size_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cut_size_y&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cut_size_y</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_cuts</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">cut_size_x</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">cut_size_y</span><span class="p">)))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__cutout_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]):</span>
            <span class="n">img</span><span class="p">[</span>
                <span class="n">y</span> <span class="p">:</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cut_size_y&quot;</span><span class="p">],</span>
                <span class="n">x</span> <span class="p">:</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;cut_size_x&quot;</span><span class="p">],</span>
            <span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__cutout_img</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">img</span></div>



<div class="viewcode-block" id="SaltAndPepper">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.SaltAndPepper">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SaltAndPepper</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds salt and pepper noise to an image. Other types of data than the image are ignored.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    gain_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Indicates percentage of indices, which will be changed.</span>
<span class="sd">        If float, then ``gain_range = (0, gain_range)``.</span>
<span class="sd">    salt_p : float or tuple or None</span>
<span class="sd">        Percentage of salt. Percentage of pepper is ``1-salt_p``. If tuple, then ``salt_p`` is chosen</span>
<span class="sd">        uniformly from the given range.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;salt_and_pepper&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gain_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">salt_p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">SaltAndPepper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">gain_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">gain_range</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">salt_p</span> <span class="o">=</span> <span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="n">salt_p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gain_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gain_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">salt_p</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">salt_p</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">SaltAndPepper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">gain</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gain_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gain_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">salt_p</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">salt_p</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">salt_p</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">random_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="mi">32</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">sp</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">gain</span>
        <span class="n">salt</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="n">pepper</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.0</span>
        <span class="n">salt_mask</span> <span class="o">=</span> <span class="n">random_state</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">&lt;=</span> <span class="n">salt_p</span>
        <span class="n">pepper_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">salt_mask</span>
        <span class="n">salt</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">salt</span><span class="p">)]</span> <span class="o">*=</span> <span class="n">salt_mask</span>
        <span class="n">pepper</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pepper</span><span class="p">)]</span> <span class="o">*=</span> <span class="n">pepper_mask</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;salt&quot;</span><span class="p">:</span> <span class="n">salt</span><span class="p">,</span> <span class="s2">&quot;pepper&quot;</span><span class="p">:</span> <span class="n">pepper</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">img</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;salt&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="n">DTYPES_MAX</span><span class="p">[</span><span class="n">img</span><span class="o">.</span><span class="n">dtype</span><span class="p">]</span>
        <span class="n">img</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;pepper&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">img</span></div>



<div class="viewcode-block" id="GammaCorrection">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.GammaCorrection">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GammaCorrection</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform applies random gamma correction</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    gamma_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Indicates percentage of indices, which will be changed.</span>
<span class="sd">        If float, then ``gain_range = (1-gamma_range, 1+gamma_range)``.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;gamma_correction&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">gamma_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GammaCorrection</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gamma_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">gamma_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">gamma_range</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">gamma_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gamma_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gamma_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gamma_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gamma_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">inv_gamma</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">gamma</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([((</span><span class="n">i</span> <span class="o">/</span> <span class="mf">255.0</span><span class="p">)</span> <span class="o">**</span> <span class="n">inv_gamma</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gamma&quot;</span><span class="p">:</span> <span class="n">gamma</span><span class="p">,</span> <span class="s2">&quot;LUT&quot;</span><span class="p">:</span> <span class="n">lut</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LUT&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="Contrast">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Contrast">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Contrast</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform randomly changes the contrast</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    contrast_range : tuple or float or None</span>
<span class="sd">        Gain of the noise. Indicates percentage of indices, which will be changed.</span>
<span class="sd">        If float, then ``gain_range = (1-contrast_range, 1+contrast_range)``.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;contrast&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">contrast_range</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Contrast</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">contrast_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">contrast_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">contrast_range</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">contrast_range</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">contrast_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">contrast_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">contrast_mul</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contrast_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">contrast_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="o">*</span> <span class="n">contrast_mul</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;contrast_mul&quot;</span><span class="p">:</span> <span class="n">contrast_mul</span><span class="p">,</span> <span class="s2">&quot;LUT&quot;</span><span class="p">:</span> <span class="n">lut</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LUT&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="Blur">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Blur">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Blur</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Transform blurs an image</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    blur_type : str</span>
<span class="sd">        Blur type. See allowed blurs in `solt.constants`</span>
<span class="sd">    k_size: int or tuple</span>
<span class="sd">        Kernel sizes of the blur. if int, then sampled from ``(k_size, k_size)``. If tuple,</span>
<span class="sd">        then sampled from the whole tuple. All the values here must be odd.</span>
<span class="sd">    gaussian_sigma: int or float or tuple</span>
<span class="sd">        Gaussian sigma value. Used for both X and Y axes. If None, then gaussian_sigma=1.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    solt.constants.ALLOWED_BLURS</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;blur&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">blur_type</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">k_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">gaussian_sigma</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Blur</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Incorrect kernel size&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">k_size</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">k_size</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">k_size</span> <span class="o">=</span> <span class="p">(</span><span class="n">k_size</span><span class="p">,</span> <span class="n">k_size</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">k_size</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">k</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Kernel size must be an odd integer&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gaussian_sigma</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="n">gaussian_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="n">gaussian_sigma</span><span class="p">,</span> <span class="n">gaussian_sigma</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">=</span> <span class="n">validate_parameter</span><span class="p">(</span><span class="n">blur_type</span><span class="p">,</span> <span class="n">ALLOWED_BLURS</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">,</span> <span class="n">basic_type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">heritable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k_size</span> <span class="o">=</span> <span class="n">k_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gaussian_sigma</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">gaussian_sigma</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_size</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gaussian_sigma</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaussian_sigma</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;k_size&quot;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">==</span> <span class="s2">&quot;mo&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_size</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower bound for blur kernel size cannot be less than 2 for motion blur&quot;</span><span class="p">)</span>

            <span class="n">kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">k</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
            <span class="n">xs</span><span class="p">,</span> <span class="n">xe</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">xs</span> <span class="o">==</span> <span class="n">xe</span><span class="p">:</span>
                <span class="n">ys</span><span class="p">,</span> <span class="n">ye</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">k</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ys</span><span class="p">,</span> <span class="n">ye</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">cv2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">kernel</span><span class="p">,</span> <span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">),</span> <span class="p">(</span><span class="n">xe</span><span class="p">,</span> <span class="n">ye</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">kernel</span> <span class="o">=</span> <span class="n">kernel</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kernel</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;motion_kernel&quot;</span><span class="p">:</span> <span class="n">kernel</span><span class="p">})</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">==</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">GaussianBlur</span><span class="p">(</span>
                <span class="n">img</span><span class="p">,</span>
                <span class="n">ksize</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;k_size&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;k_size&quot;</span><span class="p">]),</span>
                <span class="n">sigmaX</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">==</span> <span class="s2">&quot;m&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">medianBlur</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">ksize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;k_size&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">blur</span> <span class="o">==</span> <span class="s2">&quot;mo&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">filter2D</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;motion_kernel&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="HSV">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.HSV">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">HSV</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs a random HSV color shift.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    h_range: tuple or None</span>
<span class="sd">        Hue shift range. If None, than ``h_range=(0, 0)``.</span>
<span class="sd">    s_range: tuple or None</span>
<span class="sd">        Saturation shift range. If None, then ``s_range=(0, 0)``.</span>
<span class="sd">    v_range: tuple or None</span>
<span class="sd">        Value shift range. If None, then ``v_range=(0, 0)``.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;hsv&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">h_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">s_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">HSV</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">h_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">h_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">s_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">v_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">v_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">h_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">h_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">v_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;h_mod&quot;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="s2">&quot;s_mod&quot;</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;v_mod&quot;</span><span class="p">:</span> <span class="n">v</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">dtype</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Image has to have 3 channels!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Image type has to be uint8 in this version of SOLT!&quot;</span><span class="p">)</span>

        <span class="n">img_hsv</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2HSV</span><span class="p">)</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">img_hsv</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">))</span>

        <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">h</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;h_mod&quot;</span><span class="p">])</span> <span class="o">%</span> <span class="mi">180</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;s_mod&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">v</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;v_mod&quot;</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>

        <span class="n">img_hsv_shifted</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">merge</span><span class="p">((</span><span class="n">h</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">v</span><span class="p">))</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img_hsv_shifted</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_HSV2RGB</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span></div>



<div class="viewcode-block" id="Brightness">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.Brightness">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Brightness</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs a random brightness augmentation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    brightness_range: tuple or None</span>
<span class="sd">        brightness_range shift range. If None, then ``brightness_range=(0, 0)``.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_default_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;brightness&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">brightness_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Brightness</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">brightness_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">brightness_range</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_range</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">brightness_fact</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">brightness_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">brightness_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span> <span class="o">+</span> <span class="n">brightness_fact</span>
        <span class="n">lut</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">lut</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;uint8&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;brightness_fact&quot;</span><span class="p">:</span> <span class="n">brightness_fact</span><span class="p">,</span> <span class="s2">&quot;LUT&quot;</span><span class="p">:</span> <span class="n">lut</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LUT&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="IntensityRemap">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.IntensityRemap">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IntensityRemap</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs random intensity remapping [1]_.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform,</span>
<span class="sd">    kernel_size: int</span>
<span class="sd">        Size of medial filter kernel used during the generation of intensity mapping.</span>
<span class="sd">        Higher value yield more monotonic mapping.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    References</span>
<span class="sd">    ----------</span>
<span class="sd">    .. [1] Hesse, L. S., Kuling, G., Veta, M., &amp; Martel, A. L. (2019).</span>
<span class="sd">       Intensity augmentation for domain transfer of whole breast</span>
<span class="sd">       segmentation in MRI. https://arxiv.org/abs/1909.02642</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;intensity_remap&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IntensityRemap</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span> <span class="o">=</span> <span class="n">kernel_size</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">k</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">signal</span><span class="o">.</span><span class="n">medfilt</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">kernel_size</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">256</span><span class="p">)</span>

        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>
        <span class="n">m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;LUT&quot;</span><span class="p">:</span> <span class="n">m</span><span class="p">}</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;IntensityRemap supports uint8 ndarrays only&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only grayscale 2D images are supported&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">LUT</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;LUT&quot;</span><span class="p">])</span></div>



<div class="viewcode-block" id="CvtColor">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.CvtColor">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">CvtColor</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    RGB to grayscale or grayscale to RGB image conversion.</span>

<span class="sd">    If converting from grayscale to RGB, then the gs channel is simply clonned.</span>
<span class="sd">    If converting from RGB to grayscale, then opencv is used.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    mode : str or None</span>
<span class="sd">        Color conversion mode. If None, then no conversion happens and mode=none.</span>
<span class="sd">        If ``mode == &#39;rgb2gs&#39;`` and the image is already grayscale,</span>
<span class="sd">        then nothing happens. If ``mode == &#39;gs2rgb&#39;`` and the image is already RGB,</span>
<span class="sd">        then also nothing happens.</span>
<span class="sd">    keep_dim : bool</span>
<span class="sd">        Whether to enforce having three channels when performing rgb to grayscale conversion</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of the transform&#39;s use. 1 by default</span>
<span class="sd">    See also</span>
<span class="sd">    --------</span>
<span class="sd">    solt.constants.ALLOWED_COLOR_CONVERSIONS</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;cvt_color&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">keep_dim</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">CvtColor</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">validate_parameter</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">ALLOWED_COLOR_CONVERSIONS</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">heritable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">keep_dim</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Incorrect type of keepdim&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keepdim</span> <span class="o">=</span> <span class="n">keep_dim</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;gs2rgb&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Grayscale images must also have 3 channels&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">img</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">img</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;rgb2gs&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;RGB images must have 3 channels&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">img</span>
            <span class="k">elif</span> <span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">COLOR_RGB2GRAY</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">keepdim</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">res</span>
                <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">res</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">res</span><span class="p">))</span></div>



<div class="viewcode-block" id="KeypointsJitter">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.KeypointsJitter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">KeypointsJitter</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Applies the jittering to the keypoints in X- and Y-durections</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying the transform</span>
<span class="sd">    dx_range: None or float or tuple of float</span>
<span class="sd">        Jittering across X-axis. Valid range is ``(-1, 1)``</span>
<span class="sd">    dy_range: None or float or tuple of float</span>
<span class="sd">        Jittering across Y-axis. Valid range is ``(-1, 1)``</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;keypoints_jitter&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">dx_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dy_range</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">KeypointsJitter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dx_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">dx_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">dy_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">img</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">mask</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">pts_data</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">height</span>
        <span class="n">w</span> <span class="o">=</span> <span class="n">pts</span><span class="o">.</span><span class="n">width</span>

        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">pts</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">w</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dy_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
            <span class="n">pts_data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pts_data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">pts_data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">pts_data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">dy</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Keypoints</span><span class="p">(</span><span class="n">pts_data</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span></div>



<div class="viewcode-block" id="JPEGCompression">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.JPEGCompression">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">JPEGCompression</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs random JPEG-based worsening of images.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    quality_range : float or tuple of int or int or None</span>
<span class="sd">        If float, then the lower bound to sample the quality is</span>
<span class="sd">        between ``(quality_range*100%, 100%)``.</span>

<span class="sd">        If tuple of int, then it directly sets the quality range.</span>

<span class="sd">        If tuple of float, then the quality is sampled from</span>
<span class="sd">        ``[quality_range[0]*100%, quality_range[1]*100%]``.</span>

<span class="sd">        If int, then the quality is sampled from ``[quality_range, 100]``.</span>
<span class="sd">        .</span>
<span class="sd">        If None, that the quality range is ``[100, 100]``.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;jpeg_compression&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">quality_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">JPEGCompression</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">quality_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quality_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">quality_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">quality_range</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">quality_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">quality_range</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
                <span class="n">quality_range</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
                    <span class="nb">int</span><span class="p">(</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Wrong type of quality range!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Wrong type of quality range!&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">quality_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">quality_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">quality_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">encoded_img</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imencode</span><span class="p">(</span><span class="s2">&quot;.jpg&quot;</span><span class="p">,</span> <span class="n">img</span><span class="p">,</span> <span class="p">(</span><span class="n">cv2</span><span class="o">.</span><span class="n">IMWRITE_JPEG_QUALITY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;quality&quot;</span><span class="p">]))</span>
        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">imdecode</span><span class="p">(</span><span class="n">encoded_img</span><span class="p">,</span> <span class="n">cv2</span><span class="o">.</span><span class="n">IMREAD_UNCHANGED</span><span class="p">)</span></div>



<div class="viewcode-block" id="GridMask">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.GridMask">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GridMask</span><span class="p">(</span><span class="n">ImageTransform</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Performs a GridMask augmentation.</span>

<span class="sd">    https://arxiv.org/abs/2001.04086</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    d_range: int or tuple or None</span>
<span class="sd">        The range of parameter d. If tuple, then the d is chosen between ``(d_range[0], d_range[1])``.</span>
<span class="sd">        If none, then the d is chosen between ``(1, 2)``.</span>
<span class="sd">    ratio: float</span>
<span class="sd">        The value of parameter ratio, defines the distance between GridMask squares.</span>
<span class="sd">    rotate : int or tuple or None</span>
<span class="sd">        If int, then the angle of grid mask rotation is between ``(-rotate, rotate)``.</span>
<span class="sd">        If tuple, then the angle of grid mask rotation is between ``(rotate[0], rotate[1])``.</span>
<span class="sd">    mode : str or None</span>
<span class="sd">        GridMask mode. If ``&#39;crop&#39;``, then the default GridMask is applied.</span>
<span class="sd">        If ``&#39;crop&#39;``, the inversed GridMask is applied.</span>
<span class="sd">    data_indices : tuple or None</span>
<span class="sd">        Indices of the images within the data container to which this transform needs to be applied.</span>
<span class="sd">        Every element within the tuple must be integer numbers.</span>
<span class="sd">        If None, then the transform will be applied to all the images withing the DataContainer.</span>
<span class="sd">    p : float</span>
<span class="sd">        Probability of applying this transform.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;gridmask&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">d_range</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">rotate</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GridMask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">data_indices</span><span class="o">=</span><span class="n">data_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">d_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">d_range</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">d_range</span> <span class="o">=</span> <span class="n">validate_numeric_range_parameter</span><span class="p">(</span><span class="n">d_range</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">),</span> <span class="n">min_val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="n">ratio</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rotate must be an int or a tuple of int&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Rotate must be an int or a tuple of int&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">rotate</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">rotate</span><span class="p">:</span>
            <span class="n">rotate</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">rotate</span><span class="p">,</span> <span class="n">rotate</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span> <span class="o">=</span> <span class="n">rotate</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">validate_parameter</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">ALLOWED_GRIDMASK_MODES</span><span class="p">,</span> <span class="s2">&quot;none&quot;</span><span class="p">,</span> <span class="n">heritable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">GridMask</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">hh</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">h</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">w</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">d_range</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">d_range</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">hh</span><span class="p">,</span> <span class="n">hh</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">st_h</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">st_w</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">hh</span> <span class="o">//</span> <span class="n">d</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">s_row</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">st_h</span><span class="p">,</span> <span class="n">hh</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">t_row</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">st_h</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">hh</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">s_col</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">st_w</span><span class="p">,</span> <span class="n">hh</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">t_col</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">st_w</span> <span class="o">+</span> <span class="n">b</span><span class="p">,</span> <span class="n">hh</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span>

            <span class="n">mask</span><span class="p">[</span><span class="n">s_row</span><span class="p">:</span><span class="n">t_row</span><span class="p">,</span> <span class="n">s_col</span><span class="p">:</span><span class="n">t_col</span><span class="p">]</span> <span class="o">*=</span> <span class="mi">0</span>

        <span class="n">mask_w</span><span class="p">,</span> <span class="n">mask_h</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">:</span>
            <span class="n">angle</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">rotation_matrix</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">getRotationMatrix2D</span><span class="p">((</span><span class="n">mask_w</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">mask_h</span> <span class="o">//</span> <span class="mi">2</span><span class="p">),</span> <span class="n">angle</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">cv2</span><span class="o">.</span><span class="n">warpAffine</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">rotation_matrix</span><span class="p">,</span> <span class="p">(</span><span class="n">mask_w</span><span class="p">,</span> <span class="n">mask_h</span><span class="p">),</span> <span class="n">flags</span><span class="o">=</span><span class="n">cv2</span><span class="o">.</span><span class="n">INTER_NEAREST</span><span class="p">)</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">mask</span><span class="p">[(</span><span class="n">hh</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">hh</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="p">(</span><span class="n">hh</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="p">:</span> <span class="p">(</span><span class="n">hh</span> <span class="o">-</span> <span class="n">w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">w</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s2">&quot;reverse&quot;</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">mask</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">w</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">img</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">k</span><span class="p">]</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">img</span></div>



<div class="viewcode-block" id="RandomResizedCrop">
<a class="viewcode-back" href="../../../transforms.html#solt.transforms.RandomResizedCrop">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RandomResizedCrop</span><span class="p">(</span><span class="n">BaseTransform</span><span class="p">,</span> <span class="n">InterpolationPropertyHolder</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Random resized crop transform.</span>

<span class="sd">    Random cropping of a random size with a random aspect ratio, and then resizes the crop to a</span>
<span class="sd">    target size.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    resize_to : tuple or int or None</span>
<span class="sd">        Size of the crop ``(width_new, height_new)``. If ``int``, then a square crop will be made.</span>
<span class="sd">    scale : tuple of flat or None</span>
<span class="sd">        Range of size of the origin size cropped. If None, then default Imagenet values are used -- ``(0.08, 1.0)``.</span>
<span class="sd">    ratio : tuple of float or None</span>
<span class="sd">        Range of the aspect ratio. If None, then default Imagenet values are used -- ``(3 / 4., 4 / 3.)``.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">serializable_name</span> <span class="o">=</span> <span class="s2">&quot;random_resized_crop&quot;</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;How the class should be stored in the registry&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ratio</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s2">&quot;bilinear&quot;</span><span class="p">):</span>
        <span class="n">BaseTransform</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">InterpolationPropertyHolder</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interpolation</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scale</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.08</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ratio</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.3333333333333333</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resize_to</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="nb">list</span><span class="p">)):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Argument crop_to has an incorrect type!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">resize_to</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">resize_to</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Incorrect type of the crop_to!&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">resize_to</span> <span class="o">=</span> <span class="p">(</span><span class="n">resize_to</span><span class="p">,</span> <span class="n">resize_to</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span> <span class="o">=</span> <span class="n">resize_to</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">sample_transform</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">DataContainer</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">w</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">RandomResizedCrop</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">sample_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">area</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">w</span>

        <span class="k">for</span> <span class="n">_attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">target_area</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">scale</span><span class="p">)</span> <span class="o">*</span> <span class="n">area</span>
            <span class="n">log_ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">aspect_ratio</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">*</span><span class="n">log_ratio</span><span class="p">))</span>

            <span class="n">new_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">target_area</span> <span class="o">*</span> <span class="n">aspect_ratio</span><span class="p">)))</span>
            <span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">target_area</span> <span class="o">/</span> <span class="n">aspect_ratio</span><span class="p">)))</span>

            <span class="k">if</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">new_w</span> <span class="o">&lt;=</span> <span class="n">w</span> <span class="ow">and</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">new_h</span> <span class="o">&lt;=</span> <span class="n">h</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">new_h</span><span class="p">)</span>
                <span class="n">j</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">new_w</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;crop_to&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">),</span>
                        <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                        <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="p">)</span>
                <span class="k">return</span>

        <span class="c1"># Fallback to central crop</span>
        <span class="n">new_h</span><span class="p">,</span> <span class="n">new_w</span> <span class="o">=</span> <span class="n">h</span><span class="p">,</span> <span class="n">w</span>
        <span class="n">in_ratio</span> <span class="o">=</span> <span class="n">w</span> <span class="o">/</span> <span class="n">h</span>
        <span class="k">if</span> <span class="n">in_ratio</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">):</span>
            <span class="n">new_w</span> <span class="o">=</span> <span class="n">w</span>
            <span class="n">new_h</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">new_w</span> <span class="o">/</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">)))</span>
        <span class="k">elif</span> <span class="n">in_ratio</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">):</span>
            <span class="n">new_h</span> <span class="o">=</span> <span class="n">h</span>
            <span class="n">new_w</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">new_h</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ratio</span><span class="p">)))</span>

        <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">new_h</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">j</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="n">new_w</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;crop_to&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">new_w</span><span class="p">,</span> <span class="n">new_h</span><span class="p">),</span>
                <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">i</span><span class="p">,</span>
                <span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="n">j</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">__crop_img_or_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_mask</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">img_mask</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;y&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;crop_to&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;x&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">[</span><span class="s2">&quot;crop_to&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">]</span>

    <span class="nd">@img_shape_checker</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_img</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__crop_img_or_mask</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">img</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="n">ALLOWED_INTERPOLATIONS</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;strict&quot;</span><span class="p">:</span>
            <span class="n">interp</span> <span class="o">=</span> <span class="n">ALLOWED_INTERPOLATIONS</span><span class="p">[</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;interpolation&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">return</span> <span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">resize_to</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="n">interp</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__crop_img_or_mask</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_labels</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">labels</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">labels</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_apply_pts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">:</span> <span class="n">Keypoints</span><span class="p">,</span> <span class="n">settings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Made for images only at this stage&quot;</span><span class="p">)</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Aleksei Tiulpin, Research Unit of Medical Imaging, Physics and Technology. University of Oulu.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>